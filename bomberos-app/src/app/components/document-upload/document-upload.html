<div class="upload-container mat-elevation-z4">
  <h1 class="page-title">
    Flujo de Ingreso de Documentos<br>Bombero Accidentado
  </h1>

  @if (currentStep() === -1) {
    <div class="process-status">
      <h2>Estado Del Proceso</h2>
      <button mat-flat-button color="warn" (click)="startProcess()">Iniciar Proceso</button>
    </div>
  } @else {
    <p class="process-message">Siga los pasos para completar el ingreso de documentos.</p>
  }

  @if (currentStep() === steps().length) {
    <div class="completion-message">
      <mat-icon>check_circle</mat-icon>
      <span>¡Proceso completado con éxito! Redirigiendo...</span>
    </div>
  }

  <h2 class="checklist-title">Pasos del Proceso (Checklist)</h2>

  <div class="checklist">
    @for (step of steps(); track step; let i = $index) {
      <div class="step-item" 
           [class.active]="currentStep() === i"
           [class.completed]="step.isCompleted">

        <div class="step-header">
          <div class="step-info">
            <span class="step-number">{{ i + 1 }}.</span>
            <span class="step-title">{{ step.title }}</span>
            @if (step.optional) {
              <span class="optional-badge">Opcional</span>
            }
          </div>
          @if (step.isCompleted) {
            <mat-icon class="completion-icon">check_circle</mat-icon>
          }
        </div>

        @if (currentStep() === i) {
          <div class="step-content">
            
            <div class="drag-area" 
                (click)="fileInput.click()"
                (dragover)="onDragOver($event)"
                (dragleave)="onDragLeave($event)"
                (drop)="onDrop($event, i)">
              
              @if (step.files.length === 0) {
                <mat-icon>upload</mat-icon>
                <p>Arrastra y suelta archivos aquí o haz clic para seleccionar</p>
              } @else {
                <ul class="file-list">
                  @for (file of step.files; track file) {
                    <li>{{ file.name }} ({{ (file.size / 1024).toFixed(2) }} KB)</li>
                  }
                </ul>
              }
              <input type="file" #fileInput hidden (change)="handleFiles($any($event.target).files, i)">
            </div>
            
            <div class="action-buttons">
              @if (step.optional) {
                <button mat-stroked-button (click)="nextStep()">No Aplica</button>
              }
              <button mat-flat-button color="warn" [disabled]="step.files.length === 0" (click)="nextStep()">
                Listo y Continuar
              </button>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>