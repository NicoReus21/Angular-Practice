<form [formGroup]="reportForm" (ngSubmit)="onSave()">
  <h1 mat-dialog-title class="dialog-title">
    Reporte de Servicio/Mantención
    <button
      mat-icon-button
      class="close-button"
      (click)="onCancel()"
      type="button"
      matTooltip="Cerrar"
    >
      <mat-icon>close</mat-icon>
    </button>
  </h1>

  <div mat-dialog-content class="dialog-content">
    <h3 class="section-title">Información de la Unidad</h3>
    <div class="form-row">
      <mat-form-field appearance="outline" class="form-field-third">
        <mat-label>Modelo</mat-label>
        <input matInput formControlName="model" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="form-field-third">
        <mat-label>Patente</mat-label>
        <input matInput formControlName="plate" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="form-field-third">
        <mat-label>Compañía</mat-label>
        <input matInput formControlName="company" />
      </mat-form-field>
    </div>

    <div class="form-row">

      <mat-form-field appearance="outline" class="form-field-half">
        <mat-label>N° de Chasis</mat-label>
        <input matInput formControlName="chassis_number" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="form-field-half">
        <mat-label>Kilometraje</mat-label>
        <input matInput formControlName="mileage" type="number" required />
        @if (reportForm.get('mileage')?.hasError('required')) {
        <mat-error>El kilometraje es obligatorio</mat-error>
        }
      </mat-form-field>
    </div>

    <mat-divider class="section-divider"></mat-divider>
    <h3 class="section-title">Detalles de Inspección</h3>

    <div class="form-row">
      <mat-form-field appearance="outline" class="form-field-third">
        <mat-label>Cabina</mat-label>
        <input matInput formControlName="cabin" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="form-field-third">
        <mat-label>Filtros (Código)</mat-label>
        <input matInput formControlName="filter_code" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="form-field-third">
        <mat-label>Horómetro</mat-label>
        <input matInput formControlName="hourmeter" />
      </mat-form-field>
    </div>

    <mat-form-field appearance="outline">
      <mat-label>Señales de Advertencia (Informar cada compañía)</mat-label>
      <textarea matInput formControlName="warnings"></textarea>
    </mat-form-field>

    <mat-divider class="section-divider"></mat-divider>
    <h3 class="section-title">Detalles del Servicio</h3>
    <div class="form-row">
      <mat-form-field appearance="outline" class="form-field-third">
        <mat-label>Tipo de Servicio</mat-label>
        <mat-select formControlName="service_type" required>
          <mat-option value="Mantención Preventiva">Mantención Preventiva</mat-option>
          <mat-option value="Mantención Correctiva">Mantención Correctiva</mat-option>
          <mat-option value="Revisión General">Revisión General</mat-option>
          <mat-option value="Reparación">Reparación</mat-option>
        </mat-select>
        @if (reportForm.get('service_type')?.hasError('required')) {
        <mat-error>El tipo de servicio es obligatorio</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field-third">
        <mat-label>Inspector a Cargo</mat-label>
        <input matInput formControlName="inspector_name" required />
        @if (reportForm.get('inspector_name')?.hasError('required')) {
        <mat-error>El inspector es obligatorio</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field-third">
        <mat-label>Fecha de Realización</mat-label>
        <input matInput [matDatepicker]="picker" formControlName="service_date" required />
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
    </div>

    <mat-form-field appearance="outline">
      <mat-label>Ubicación del Equipo</mat-label>
      <input matInput formControlName="location" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Problema Reportado</mat-label>
      <textarea matInput formControlName="reported_problem" rows="3" required></textarea>
      @if (reportForm.get('reported_problem')?.hasError('required')) {
      <mat-error>El problema reportado es obligatorio</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Detalle de Actividades Desarrolladas</mat-label>
      <textarea matInput formControlName="activities_detail" rows="5" required></textarea>
      @if (reportForm.get('activities_detail')?.hasError('required')) {
      <mat-error>El detalle de actividades es obligatorio</mat-error>
      }
    </mat-form-field>

    <mat-divider class="section-divider"></mat-divider>
    <h3 class="section-title">Cierre y Pendientes</h3>

    <div class="form-row">
      <mat-form-field appearance="outline" class="form-field-half">
        <mat-label>Trabajo Pendiente</mat-label>
        <textarea matInput formControlName="pending_work" rows="2"></textarea>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field-half">
        <mat-label>Tipo de Pendiente</mat-label>
        <mat-select formControlName="pending_type">
          <mat-option value="Ninguno">Ninguno</mat-option>
          <mat-option value="Crítico">Crítico</mat-option>
          <mat-option value="Normal">Normal</mat-option>
          <mat-option value="Bajo">Bajo</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <mat-form-field appearance="outline">
      <mat-label>Observaciones Complementarias</mat-label>
      <textarea matInput formControlName="observations" rows="3"></textarea>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Anexo Información del Carro</mat-label>
      <textarea matInput formControlName="car_info_annex" rows="3"></textarea>
    </mat-form-field>

    <div class="form-row">
      <mat-form-field appearance="outline" class="form-field-half">
        <mat-label>Firma Inspector Responsable</mat-label>
        <input matInput formControlName="inspector_signature" required />
        @if (reportForm.get('inspector_signature')?.hasError('required')) {
        <mat-error>La firma del inspector es obligatoria</mat-error>
        }
      </mat-form-field>
      <mat-form-field appearance="outline" class="form-field-half">
        <mat-label>Firma Oficial a Cargo</mat-label>
        <input matInput formControlName="officer_signature" required />
        @if (reportForm.get('officer_signature')?.hasError('required')) {
        <mat-error>La firma del oficial es obligatoria</mat-error>
        }
      </mat-form-field>
    </div>

    <div>
      <label for="file-upload" class="file-upload-label">
        <mat-icon>attach_file</mat-icon>
        Subir Documentos (PDF, Imágenes, etc.)
      </label>
      <input
        id="file-upload"
        type="file"
        multiple
        (change)="onFileSelected($event)"
        class="file-input"
      />
      <!-- TODO: Mostrar los archivos seleccionados (selectedFiles()) con un botón para eliminarlos -->
    </div>
  </div>

  <div mat-dialog-actions class="dialog-actions" align="end">
    <button mat-stroked-button (click)="onCancel()" type="button">Cancelar</button>
    <button mat-flat-button color="primary" type="submit" [disabled]="reportForm.invalid">
      Guardar Reporte
    </button>
  </div>
</form>